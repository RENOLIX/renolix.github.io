<!-- bottom-nav.html -->
<style>
  :root{
    --gold:#d4af37;
    --gold2:#ffd700;
    --ink:#222;
    --glass:rgba(255,255,255,0.92);
    --font-family:'Montserrat',sans-serif; /* même police que ton site */
  }

  body { padding-bottom: calc(88px + env(safe-area-inset-bottom)); font-family:var(--font-family); }

  .bottom-nav{
    position:fixed;
    left:50%;
    transform:translateX(-50%);
    bottom: calc(10px + env(safe-area-inset-bottom));
    width:min(900px, calc(100% - 20px));
    height:68px;
    display:grid; grid-template-columns:repeat(4,1fr);
    background:var(--glass);
    backdrop-filter:blur(12px);
    border:2px solid var(--gold);
    border-radius:18px;
    box-shadow:0 10px 25px rgba(0,0,0,0.22);
    z-index:1100;
    font-family:var(--font-family);
  }

  .bn-item{
    display:flex; flex-direction:column; align-items:center; justify-content:center; gap:4px;
    text-decoration:none; color:var(--ink); font-weight:700; font-size:12px; letter-spacing:.2px;
    transition:transform .15s ease;
  }
  .bn-item:active{ transform:translateY(1px); }

  .bn-icon svg{ width:22px; height:22px; fill:#666; transition:transform .2s ease, filter .2s ease, fill .2s ease; }
  .bn-item:hover .bn-icon svg{ filter:drop-shadow(0 0 8px rgba(212,175,55,.5)); transform:translateY(-2px); }
  .bn-item.active .bn-icon svg,
  .bn-item.active .bn-label{ color:var(--gold); fill:var(--gold); }

  .bn-cta{
    margin:8px; border-radius:14px;
    background:linear-gradient(90deg,var(--gold),var(--gold2));
    box-shadow:0 0 12px rgba(212,175,55,.55), inset 0 1px 0 rgba(255,255,255,.4);
    color:#fff;
  }
  .bn-cta .bn-icon svg{ fill:#fff; }
  .bn-cta .bn-label{ color:#fff; }

  @media (prefers-reduced-motion: reduce){
    .bn-item,.bn-icon svg{ transition:none !important; }
  }
</style>

<nav class="bottom-nav" role="navigation" aria-label="Navigation inférieure">
  <a href="index.html" class="bn-item" data-route="index.html" aria-label="Accueil">
    <span class="bn-icon" aria-hidden="true">
      <svg viewBox="0 0 24 24"><path d="M12 3 3 11v8a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2v-4h2v4a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2v-8Z"/></svg>
    </span>
    <span class="bn-label">Accueil</span>
  </a>

  <a href="suivi-chantier.html" class="bn-item" data-route="suivi-chantier.html" data-auth="required" aria-label="Suivi du chantier">
    <span class="bn-icon" aria-hidden="true">
      <svg viewBox="0 0 24 24"><path d="M9 7h10v2H9zM9 11h10v2H9zM9 15h10v2H9zM7.5 6 6 7.5 4.5 6 3 7.5 6 10.5 9 7.5z"/></svg>
    </span>
    <span class="bn-label">Suivi</span>
  </a>

  <a href="devis-gratuit.html" class="bn-item bn-cta" data-route="devis-gratuit.html" aria-label="Demander un devis">
    <span class="bn-icon" aria-hidden="true">
      <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path fill="#fff" d="M14 2v6h6"/><path d="M8 12h6M8 16h8"/></svg>
    </span>
    <span class="bn-label">Devis</span>
  </a>

  <a href="login.html" class="bn-item" id="bn-profile" data-route="profil.html" aria-label="Profil">
    <span class="bn-icon" aria-hidden="true">
      <svg viewBox="0 0 24 24"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Z"/><path d="M4 20a8 8 0 0 1 16 0v1H4Z"/></svg>
    </span>
    <span class="bn-label" id="bn-profile-label">Profil</span>
  </a>
</nav>

<script>
(function(){
  function getSb(){
    if (window._sb && window._sb.auth && window._sb.auth.getUser) return window._sb;
    if (typeof supabaseClient !== 'undefined' && supabaseClient.auth && supabaseClient.auth.getUser) return supabaseClient;
    return null;
  }

  // Activer le lien actif
  function setActive(){
    var path = (location.pathname || "").toLowerCase();
    document.querySelectorAll('.bottom-nav .bn-item').forEach(function(a){
      var route = (a.getAttribute('data-route')||"").toLowerCase();
      if(!route) return;
      if(path.endsWith(route) || (route==='index.html' && (path.endsWith('/') || path===''))){
        a.classList.add('active');
      }
    });
  }
  setActive();

  // Redirection si lien protégé
  function guardAuthLink(e){
    var href = e.currentTarget.getAttribute('href');
    var sb = getSb();
    e.preventDefault();
    if(!sb){
      location.href = 'login.html?next='+encodeURIComponent(href);
      return;
    }
    sb.auth.getUser().then(({data:{user}})=>{
      if(user){ location.href = href; }
      else{ location.href = 'login.html?next='+encodeURIComponent(href); }
    }).catch(()=>{ location.href = 'login.html?next='+encodeURIComponent(href); });
  }
  document.querySelectorAll('.bottom-nav .bn-item[data-auth="required"]').forEach(a=>{
    a.addEventListener('click', guardAuthLink);
  });

  // Mettre à jour Profil selon la session
  function updateProfileLink(){
    var a = document.getElementById('bn-profile');
    var lbl = document.getElementById('bn-profile-label');
    if(!a || !lbl) return;
    var sb = getSb();
    if(!sb){
      a.setAttribute('href','login.html');
      lbl.textContent = 'Se connecter';
      a.setAttribute('data-auth','required');
      return;
    }
    sb.auth.getUser().then(({data:{user}})=>{
      if(user){
        a.setAttribute('href','profil.html');
        lbl.textContent = 'Profil';
        a.removeAttribute('data-auth');
      }else{
        a.setAttribute('href','login.html');
        lbl.textContent = 'Se connecter';
        a.setAttribute('data-auth','required');
      }
    });
    if(sb && sb.auth && sb.auth.onAuthStateChange){ sb.auth.onAuthStateChange(updateProfileLink); }
  }
  updateProfileLink();
})();
</script>